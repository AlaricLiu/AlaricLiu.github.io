<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Title:MySQL学习Date：2016-4-27Author：AlaricLiu
#mysql修改用户密码#
##问题1##
“Host ‘localhost’ is not allowed to connect to this MySQL server.”

###现象与产生原因###USE mysqlUPDATE user SET password=’YES’ where user=’r">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2016/04/25/修改Mysql密码/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Title:MySQL学习Date：2016-4-27Author：AlaricLiu
#mysql修改用户密码#
##问题1##
“Host ‘localhost’ is not allowed to connect to this MySQL server.”

###现象与产生原因###USE mysqlUPDATE user SET password=’YES’ where user=’r">
<meta property="og:updated_time" content="2016-04-27T06:36:44.811Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="Title:MySQL学习Date：2016-4-27Author：AlaricLiu
#mysql修改用户密码#
##问题1##
“Host ‘localhost’ is not allowed to connect to this MySQL server.”

###现象与产生原因###USE mysqlUPDATE user SET password=’YES’ where user=’r">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-修改Mysql密码" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/25/修改Mysql密码/" class="article-date">
  <time datetime="2016-04-25T07:07:49.752Z" itemprop="datePublished">2016-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Title:MySQL学习<br>Date：2016-4-27<br>Author：AlaricLiu</p>
<p>#mysql修改用户密码#</p>
<p>##问题1##</p>
<font color="red">“Host ‘localhost’ is not allowed to connect to this MySQL server.”</font>

<p>###现象与产生原因###<br>USE mysql<br>UPDATE user SET password=’YES’ where user=’root’ AND host=’localhost’;<br>FLUSH PRIVILEGES;</p>
<font color="red">SET password=’YES’，是个梗。以后要用set password=PASSWORD(‘YES’);</font>

<p>退出控制台后就再进不去了。<br>mysql -u root -p<br>mysql -h localhost -u root -p<br>都不行，出现错误：<br>“Host ‘localhost’ is not allowed to connect to this MySQL server.”</p>
<p>###方法###<br>首先停止mysql服务：</p>
<pre><code>service stop mysqld
</code></pre><p>然后：</p>
<pre><code>mysqld --skip-grant-tables
</code></pre><p>另开一个终端，继续</p>
<pre><code>mysqlcheck --check-upgrade --all-databases --auto-repair
</code></pre><p>然后再输入</p>
<pre><code>mysql
</code></pre><p>就可以进入MySQL控制台了。mysql库中user表的密码为YES，正常来讲应该是密文。</p>
<table><br><tr><br><td>HOST</td><br><td>USER</td><br><td>PWD</td><br></tr><br><tr><br><td>localhost</td><br><td>root</td><br><td>YES</td><br></tr><br></table>

<p>进入库</p>
<pre><code>mysql -u root
</code></pre><p>将密码还原为 root 的 HASH 值：</p>
<pre><code>UPDATE uesr SET password=PASSWORD(&apos;YES&apos;) where user=&apos;root&apos; AND host=&apos;localhost&apos;;
</code></pre><p>重启mysqld服务。</p>
<p>如果mysql服务无法正常停止，使用命令：</p>
<p><code>mysqladmin -u root shutdown</code> </p>
<p>##问题2##<br>启动mysql 报错：</p>
<pre><code>ERROR 2002 (HY000): Can’t connect to local MySQL server through socket ‘/var/lib/mysql/mysql.sock’ (2)
</code></pre><p>1、先查看 <code>/etc/rc.d/init.d/mysqld status</code> 看看mysqld是否已经启动.<br>另外看看是不是权限问题.</p>
<p>2、确定你的mysql.sock是不是在那个位置，</p>
<pre><code>mysql -u 你的mysql用户名 -p -S /var/lib/mysql/mysql.sock
</code></pre><p>3、试试：</p>
<p><code>service mysqld start</code></p>
<p>4、如果是权限问题，则先改变权限</p>
<pre><code>`#chown -R mysql:mysql /var/lib/mysql`

[root@localhost ~]# /etc/init.d/mysqld start
启动 MySQL： [ 确定 ]
[root@localhost ~]# mysql -uroot -p
</code></pre><p>##问题3##</p>
<font color="red">host is not allowed to connect的问题</font>

<pre><code>grant all PRIVILEGES on *.* to root@&apos;192.168.1.101&apos;  identified by &apos;YES&apos;;
flush privileges; 
</code></pre><p>上面的语句表示将 所有 数据库的所有权限授权给 root 这个用户，允许 root 用户在 192.168.1.101 这个 IP 进行远程登陆，并设置 root 用户的密码为 YES 。</p>
<p>##问题4##</p>
<font color="red">ACCESS denied for root@’localhost’</font>

<p>首先停掉mysql服务器</p>
<pre><code>[root@DB-Server init.d]# /etc/rc.d/init.d/mysql stop
</code></pre><p>然后使用mysqld_safe命令在启动mysql，更新root账号的密码</p>
<p>–skip-grant-tables：不启动grant-tables(授权表),跳过权限控制。</p>
<p>–skip-networking ：跳过TCP/IP协议，只在本机访问(从网上有些资料看，这个选项不是必须的。可以不用)</p>
<pre><code>mysqld_safe --user=mysql --skip-grant-tables --skip-networking &amp;

mysql -u root mysql

mysql&gt; select Host, User, Password,password_expired
-&gt; from user
-&gt; where user=&apos;root&apos; and host=&apos;root&apos; or host=&apos;localhost&apos;;

mysql&gt; update user set password=PASSWORD(&apos;YES&apos;)
-&gt; where user=&apos;root&apos; and host=&apos;root&apos; or host=&apos;localhost&apos;;

flush privileges

mysql -u root -p
</code></pre><p>##mysql使用##</p>
<p>###1.新建用户###<br>    //登录MYSQL<br>    @&gt;mysql -u root -p<br>    @&gt;密码<br>    //创建用户<br>    mysql&gt; insert into mysql.user(Host,User,Password) values(“localhost”,”phplamp”,password(“1234”));<br>    //刷新系统权限表<br>    mysql&gt;flush privileges;<br>这样就创建了一个名为：phplamp  密码为：1234  的用户。</p>
<p>然后登录一下。</p>
<pre><code>mysql&gt;exit;
@&gt;mysql -u phplamp -p
@&gt;输入密码
mysql&gt;登录成功
</code></pre><p>###2.为用户授权。###</p>
<pre><code>//登录MYSQL（有ROOT权限）。我里我以ROOT身份登录.
@&gt;mysql -u root -p
@&gt;密码
//首先为用户创建一个数据库(phplampDB)
mysql&gt;create database phplampDB;
//授权phplamp用户拥有phplamp数据库的所有权限。
&gt;grant all privileges on phplampDB.* to phplamp@localhost identified by &apos;1234&apos;;
//刷新系统权限表
mysql&gt;flush privileges;
mysql&gt;其它操作

/*
如果想指定部分权限给一用户，可以这样来写:
mysql&gt;grant select,update on phplampDB.* to phplamp@localhost identified by &apos;1234&apos;;
//刷新系统权限表。
mysql&gt;flush privileges;
*/
</code></pre><p>###3.删除用户。###<br>    @&gt;mysql -u root -p<br>    @&gt;密码<br>    mysql&gt;DELETE FROM user WHERE User=”phplamp” and Host=”localhost”;<br>    mysql&gt;flush privileges;<br>    //删除用户的数据库<br>    mysql&gt;drop database phplampDB;</p>
<p>###4.修改指定用户密码。###<br>    @&gt;mysql -u root -p<br>    @&gt;密码<br>    mysql&gt;update mysql.user set password=password(‘新密码’) where User=”phplamp” and Host=”localhost”;<br>    mysql&gt;flush privileges; </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/25/修改Mysql密码/" data-id="cinily4bd0003bcmx4bllrbk2" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/04/27/c++从入门到崩溃/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Récent</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2016/04/25/交接文档/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Ancien</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-clés</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Concurrent/">Java Concurrent</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nuage de mot-clés</h3>
    <div class="widget tagcloud">
      <a href="/tags/Java-Concurrent/" style="font-size: 10px;">Java Concurrent</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/27/c++从入门到崩溃/">(no title)</a>
          </li>
        
          <li>
            <a href="/2016/04/25/修改Mysql密码/">(no title)</a>
          </li>
        
          <li>
            <a href="/2016/04/25/交接文档/">(no title)</a>
          </li>
        
          <li>
            <a href="/2016/04/25/包用途/">(no title)</a>
          </li>
        
          <li>
            <a href="/2016/04/25/Zookeeper+Kafka部署/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 John Doe<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>